#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# TypeScript check
echo "ğŸ“ TypeScript type checking..."
npm run type-check || {
  echo "âŒ TypeScript errors found. Please fix them before committing."
  exit 1
}

# ESLint check
echo "ğŸ”§ ESLint checking..."
npm run lint:check || {
  echo "âŒ ESLint errors found. Please fix them before committing."
  exit 1
}

# Check for console.log (exclude logger.ts, toast.ts, and client-side dashboard pages)
echo "ğŸš« Checking for console.log..."
if grep -r "console\.log" --include="*.ts" --include="*.tsx" src/ app/api/ --exclude-dir=node_modules --exclude="logger.ts" --exclude="toast.ts" 2>/dev/null; then
  echo "âŒ Found console.log statements in server-side code. Use logger instead."
  echo "   Replace with: import { logInfo } from '@/shared/utils/logger'"
  exit 1
fi

# Check for any types
echo "ğŸš« Checking for 'any' types..."
if grep -r ": any\|as any" --include="*.ts" --include="*.tsx" src/ app/ --exclude-dir=node_modules 2>/dev/null; then
  echo "âŒ Found 'any' types. Use proper types instead."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
