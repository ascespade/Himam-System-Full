# โ๏ธ ุญู ููุงุฆู: ุชูุนูู ุงูููุฑูููู ูู n8n

## ๐ด ุงููุดููุฉ ุงูุญุงููุฉ

```
(#2201) response does not match challenge, expected value="1064641898", received="\u003C!DOCTYPE html>..."
```

**ุงูุณุจุจ**: ุนูุฏูุง ุชุญุงูู ุชูุนูู ุงูููุฑูููู ูู n8nุ n8n ูุญุงูู ุงูุชุญูู ูู webhook ูุน Meta ุชููุงุฆูุงู. ููู ูุฃู ุงูููุฑูููู ุบูุฑ Activeุ Render ูุนูุฏ HTML ุจุฏูุงู ูู plain text challenge.

## โ ุงูุญู ุงูููุงุฆู (ุฎุทูุฉ ุจุฎุทูุฉ)

### ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู Webhook ูู Meta ุฃููุงู (ูุจู ุงูุชูุนูู)

**โ๏ธ ููู ุฌุฏุงู**: ูุฌุจ ุงูุชุญูู ูู webhook ูู Meta **ูุจู** ูุญุงููุฉ ุชูุนูู ุงูููุฑูููู ูู n8n!

1. ุงุฐูุจ ุฅูู [Meta Developer Console](https://developers.facebook.com/)
2. ุงุฎุชุฑ WhatsApp App
3. ุงุฐูุจ ุฅูู **Configuration** โ **Webhooks**
4. ูู **"ุนููุงู URL ุงูุงุณุชุฏุนุงุก" (Callback URL)**:
   - ุฃุฏุฎู: `https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook`
   - โ๏ธ ุชุฃูุฏ ูู Production URL (`/webhook/`)
5. ูู **"ุชุญูู ูู ุงูุฑูุฒ" (Verify Token)**:
   - ุฃุฏุฎู: `my-secret-token`
6. ุงุถุบุท **"ุชุญูู ูุญูุธ" (Verify and Save)**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ **Verified** (ุจุฏูู ุฃุฎุทุงุก)

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ Webhook ูุจุงุดุฑุฉ

**ุจุนุฏ ุงูุชุญูู ูู Meta**ุ ุฌุฑุจ ูู Terminal:

```bash
curl "https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook?hub.mode=subscribe&hub.verify_token=my-secret-token&hub.challenge=test123"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- ุฅุฐุง ุงูููุฑูููู **ุบูุฑ Active**: HTML (ุตูุญุฉ 404 ุฃู login)
- ุฅุฐุง ุงูููุฑูููู **Active**: `test123` (plain text)

**โ๏ธ ููุงุญุธุฉ**: ุฅุฐุง ุญุตูุช ุนูู HTMLุ ูุฐุง ูุนูู ุฃู ุงูููุฑูููู ุบูุฑ Active. ูุฌุจ ุชูุนููู ุฃููุงู (ุงูุธุฑ ุงูุฎุทูุฉ 3).

### ุงูุฎุทูุฉ 3: ุชูุนูู ุงูููุฑูููู ูู n8n

**โ๏ธ ุงููุดููุฉ**: n8n ูุทูุจ ุงูุชุญูู ูู webhook ูุน Meta ุนูุฏ ุงูุชูุนูู. ููู ุฅุฐุง ูุงู ุงูููุฑูููู ุบูุฑ Activeุ Meta ูุญุตู ุนูู HTML.

**ุงูุญู**: ุงุณุชุฎุฏู ุทุฑููุฉ ุจุฏููุฉ:

#### ุงูุทุฑููุฉ ุฃ: ุชูุนูู ุงูููุฑูููู ุจุฏูู ุงูุชุญูู

1. ุงุฐูุจ ุฅูู: `https://n8n-9q4d.onrender.com/workflow/YCZ3lqYrNxWylyg3`
2. **ุงุญูุธ** ุงูููุฑูููู ุฃููุงู (Save button)
3. ุงุถุบุท ุนูู **Toggle Switch** ุจุฌุงูุจ "Inactive"
4. ุฅุฐุง ุธูุฑุช ุฑุณุงูุฉ ุฎุทุฃ ูู Meta:
   - **ุชุฌุงูู ุงูุฎุทุฃ** (ุฅุฐุง ูุงู webhook ูุญูู ูู Meta ุจุงููุนู)
   - ุงุถุบุท **"Activate Anyway"** ุฃู **"Skip Verification"**
   - ุฃู ุฃุนุฏ ุงููุญุงููุฉ ุจุนุฏ ุจุถุน ุซูุงู

#### ุงูุทุฑููุฉ ุจ: ุงุณุชุฎุฏุงู Test URL ููุชุญูู

1. ูู Meta Developer Console:
   - ุงุณุชุฎุฏู **Test URL** ููุชุญูู: `https://n8n-9q4d.onrender.com/webhook-test/whatsapp-webhook`
   - ุจุนุฏ ุงูุชุญููุ ุงุณุชุฎุฏู **Production URL** ูู ุงูุฅุนุฏุงุฏุงุช: `https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook`
2. ุซู ูุนูู ุงูููุฑูููู ูู n8n

#### ุงูุทุฑููุฉ ุฌ: ุชูุนูู ุงูููุฑูููู ุจุนุฏ ุงูุชุญูู ูู Meta

1. **ุชุญูู ูู webhook ูู Meta ุฃููุงู** (ุงูุฎุทูุฉ 1)
2. **ุงูุชุธุฑ 10-30 ุซุงููุฉ** (ูุถูุงู ุฃู ุงูุชุญูู ุชู)
3. **ูุนูู ุงูููุฑูููู ูู n8n** (ุงูุฎุทูุฉ 3 - ุงูุทุฑููุฉ ุฃ)

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงูุชูุนูู

ุจุนุฏ ุชูุนูู ุงูููุฑูููู:

1. ุงุฐูุจ ุฅูู: `https://n8n-9q4d.onrender.com/workflow/YCZ3lqYrNxWylyg3`
2. ุชุฃูุฏ ูู ุฃู ุงูููุฑูููู **Active** โ
3. ุฌุฑุจ curl ูุฑุฉ ุฃุฎุฑู:
   ```bash
   curl "https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook?hub.mode=subscribe&hub.verify_token=my-secret-token&hub.challenge=test123"
   ```
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: `test123` (plain text)

## ๐งช ุงุฎุชุจุงุฑ ุดุงูู

### ุงุฎุชุจุงุฑ 1: ูุจู ุงูุชูุนูู

```bash
curl "https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook?hub.mode=subscribe&hub.verify_token=my-secret-token&hub.challenge=test123"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: HTML (ุตูุญุฉ 404 ุฃู login)

### ุงุฎุชุจุงุฑ 2: ุจุนุฏ ุงูุชูุนูู

```bash
curl "https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook?hub.mode=subscribe&hub.verify_token=my-secret-token&hub.challenge=test123"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: `test123` (plain text)

### ุงุฎุชุจุงุฑ 3: ูู n8n

1. ุงุถุบุท ุนูู **"Execute workflow"**
2. ุงุฎุชุฑ **"from WhatsApp Webhook Verification"**
3. ูู **Query Parameters**:
   ```
   hub.mode=subscribe
   hub.verify_token=my-secret-token
   hub.challenge=test123
   ```
4. ุงุถุบุท **Execute**
5. ูุฌุจ ุฃู ุชุฑู ูู "Respond Verification" output: `test123`

## ๐ Checklist ุงูููุงุฆู

**ูุจู ูุญุงููุฉ ุชูุนูู ุงูููุฑูููู:**

- [ ] โ ุชู ุงูุชุญูู ูู webhook ูู Meta Developer Console
- [ ] โ Webhook URL ุตุญูุญ: `https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook`
- [ ] โ Verify Token ูุชุทุงุจู: `my-secret-token`
- [ ] โ ุงูููุฑูููู ูุญููุธ ูู n8n

**ุจุนุฏ ุชูุนูู ุงูููุฑูููู:**

- [ ] โ ุงูููุฑูููู **Active** ูู n8n
- [ ] โ curl ูุนูุฏ plain text challenge
- [ ] โ Webhook ูุญูู ูู Meta

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุญูู ูู Meta ุฃููุงู**: ูุฌุจ ุงูุชุญูู ูู webhook ูู Meta **ูุจู** ูุญุงููุฉ ุชูุนูู ุงูููุฑูููู ูู n8n.

2. **ุชุฌุงูู ุฎุทุฃ ุงูุชุญูู ุนูุฏ ุงูุชูุนูู**: ุฅุฐุง ุธูุฑ ุฎุทุฃ ูู Meta ุนูุฏ ุงูุชูุนููุ ููู webhook ูุญูู ูู Meta ุจุงููุนูุ ููููู ุชุฌุงูู ุงูุฎุทุฃ ูุชูุนูู ุงูููุฑูููู.

3. **ุงูููุฑูููู ูุฌุจ ุฃู ูููู Active**: ุจุฏูู ุชูุนูู ุงูููุฑููููุ webhook ูู ูุนูู ุญุชู ูู ูุงู ูุญูู ูู Meta.

4. **Production URL vs Test URL**:
   - **Production URL**: `https://n8n-9q4d.onrender.com/webhook/whatsapp-webhook` (ููุฅูุชุงุฌ)
   - **Test URL**: `https://n8n-9q4d.onrender.com/webhook-test/whatsapp-webhook` (ููุงุฎุชุจุงุฑ ููุท)

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "response does not match challenge" ุนูุฏ ุงูุชูุนูู

**ุงูุณุจุจ**: ุงูููุฑูููู ุบูุฑ Activeุ ูุฐูู Meta ูุญุตู ุนูู HTML.

**ุงูุญู**:
1. ุชุญูู ูู webhook ูู Meta ุฃููุงู
2. ูุนูู ุงูููุฑูููู ูู n8n
3. ุฅุฐุง ุธูุฑ ุฎุทุฃุ ุชุฌุงููู (ุฅุฐุง ูุงู webhook ูุญูู ูู Meta ุจุงููุนู)

### ุงููุดููุฉ: curl ูุนูุฏ HTML ุจุนุฏ ุงูุชูุนูู

**ุงูุณุจุจ**: ุงูููุฑูููู ุบูุฑ Active ุฃู WAF ูุนูุฏ HTML.

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุฃู ุงูููุฑูููู Active
2. ุชุญูู ูู Render Logs - ูู ุชุตู ุงูุทูุจุงุช ุฅูู n8nุ
3. ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ูุฏ ุชููู ุงููุดููุฉ ูู WAF - ุฑุงุฌุน `docs/WEBHOOK_VERIFICATION_TROUBLESHOOTING.md`

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-12-06

**ุงูุฎูุงุตุฉ**: 
1. ุชุญูู ูู webhook ูู Meta ุฃููุงู
2. ูุนูู ุงูููุฑูููู ูู n8n
3. ุฅุฐุง ุธูุฑ ุฎุทุฃ ุนูุฏ ุงูุชูุนููุ ุชุฌุงููู (ุฅุฐุง ูุงู webhook ูุญูู ูู Meta ุจุงููุนู)

